(()=>{"use strict";function e(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);t&&(i=i.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),n.push.apply(n,i)}return n}function t(t){for(var i=1;i<arguments.length;i++){var s=null!=arguments[i]?arguments[i]:{};i%2?e(Object(s),!0).forEach(function(e){n(t,e,s[e])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(s)):e(Object(s)).forEach(function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(s,e))})}return t}function n(e,t,n){return(t=function(e){var t=function(e){if("object"!=typeof e||!e)return e;var t=e[Symbol.toPrimitive];if(void 0!==t){var n=t.call(e,"string");if("object"!=typeof n)return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}(e);return"symbol"==typeof t?t:t+""}(t))in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}class i{constructor(e){this.debug=!1,this.globalDebug=!1,this.componentName=e.dataset.component,this.refs={},this.dom={$component:e},this.state={},this.mountedHandlers=[]}mount(){this.log("mount",this),this.bindToWindow()}$get(e){const{dom:{$component:t}}=this;return t.querySelector(e)}$getAll(e){const{dom:{$component:t}}=this;return Array.from(t.querySelectorAll(e))}setClick(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};this.log("setClick",e,n),this.addEventHandlersForElements("click",e,t,n)}setClickWithElement(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};this.log("setClickWithElement",e,n),n.passElementToCallback=!0,this.addEventHandlersForElements("click",e,t,n)}setOnSubmit(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};this.log("setOnSubmit",e,n),this.addEventHandlersForElements("submit",e,t,n)}setOnEvent(e,t,n){let i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{};this.log("setOnEvent",t,i),this.addEventHandlersForElements(e,t,n,i)}setOnEventWithElement(e,t,n){let i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{};this.log("setOnEventWithElement",t,i),i.passElementToCallback=!0,this.addEventHandlersForElements(e,t,n,i)}setOnEscapeKey(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};this.log("setOnEscapeKey","callbackHandler: ".concat(e.name),t);const n=this.buildEscapeKeyHandler(e);this.addEventHandlerforElement("keydown",document,n,t)}setOnCustomEvent(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};this.log("setOnCustomEvent",e,n),this.addEventHandlerforElement(e,document,n=>{this.log("Event received: ".concat(e),n.detail),t.call(this,n)},n)}dispatch(e,t){this.log("Event dispatched: ".concat(e),t);const n=new CustomEvent(e,{detail:t});document.dispatchEvent(n)}log(e){if(this.debugMode()){for(var t=arguments.length,n=new Array(t>1?t-1:0),i=1;i<t;i++)n[i-1]=arguments[i];"string"==typeof e?console.log("".concat(this.componentName," / ").concat(e,": "),...n):console.log(this.componentName,e,...n)}}logWarn(e){for(var t=arguments.length,n=new Array(t>1?t-1:0),i=1;i<t;i++)n[i-1]=arguments[i];console.warn("".concat(this.componentName," / Warning: "),e,...n)}logError(e){for(var t=arguments.length,n=new Array(t>1?t-1:0),i=1;i<t;i++)n[i-1]=arguments[i];console.error("".concat(this.componentName," / Error: "),e,...n)}buildBasicHandler(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,n=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];return i=>{n&&(i.preventDefault(),i.stopPropagation());const s=t||i;e.call(this,s)}}buildEscapeKeyHandler(e){return t=>{27===t.keyCode&&e.call(this,t)}}addEventHandlersForElements(e,t,n){let i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{};this.prepareArray(t).forEach(t=>{const s=i.passElementToCallback?t:null,a=this.buildBasicHandler(n,s,i.preventDefault);this.addEventHandlerforElement(e,t,a,i)})}addBoundEventHandlerforElement(e,t,n){let i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{};const s=n.bind(this);this.addEventHandlerforElement(e,t,s,i.listenerOptions)}addEventHandlerforElement(e,t,n){let i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{};t.addEventListener(e,n,i.listenerOptions),this.addMountedEntry(t,e,n,i.listenerOptions)}addMountedEntry(e,t,n,i){const s={target:e,args:[t,n],listenerOptions:i};this.mountedHandlers.push(s)}unmount(){const{mountedHandlers:e}=this;this.log("unmount",e,this);let t=e.shift();for(;void 0!==t;)t=e.shift(),this.removeMountedEntry(t)}removeMountedEntry(e){const{target:t,args:n,listenerOptions:i}=e,s={capture:i.capture||!1};t.removeEventListener(...n,s)}bindToWindow(){if(!this.debugMode())return;window.theme=window.theme||{};const e=window.theme[this.componentName];e?(window.theme[this.componentName]=Array.isArray(e)?e:[e],window.theme[this.componentName].push(this)):window.theme[this.componentName]=this,this.log("bindToWindow",'debug this component in the browser console with "window.theme.'.concat(this.componentName,'"'))}prepareArray(e){return Array.isArray(e)?e:Array.of(e)}debugMode(){return this.globalDebug||this.debug}}(new class{constructor(){this.state={components:{},mounted:[]}}setState(e){return this.state=t(t({},this.state),e),this.state}registerComponents(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};this.setState({components:t({},e)})}deregisterComponents(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[];const{components:t}=this.state;e.forEach(e=>{delete t[e]})}mountComponents(){const{state:e}=this;[...document.querySelectorAll("[data-component]")].forEach((t,n)=>{const i=t.getAttribute("data-component");!t.getAttribute("data-mounted")&&e.components[i]&&"function"==typeof e.components[i]&&(this.setState({mounted:[...e.mounted,{id:"".concat(n),element:t,mounted:!0,instance:new e.components[i](t)}]}),t.setAttribute("data-mounted",!0))})}unmountComponents(){const{state:e}=this;e.mounted.forEach(e=>{this.componentShouldUnmount(e.element)&&e.instance&&!0===e.mounted&&"function"==typeof e.instance.unmount&&(e.instance.unmount(),e.mounted=!1)})}static componentShouldUnmount(e){return!document.documentElement.contains(e)}init(e){this.registerComponents(e),document.addEventListener("DOMContentLoaded",()=>{this.mountComponents(),this.bindToWindow()})}bindToWindow(){window.theme=window.theme||{},window.theme.views=window.theme.views||[],window.theme.views.push(this)}}).init({CheckoutShipping:class extends i{constructor(e){super(e),this.debug=!1,this.refs={selectedRate:"input[type='radio']:checked",holidays:".js-warehouseHolidays",calendarShippingRate:".js-calendarShippingRate",weekdayCutoff:".js-weekdayCutoff",saturdayCutoff:".js-saturdayCutoff",eastHandDeliveryCutoff:".js-eastHandDeliveryCutoff",westHandDeliveryCutoff:".js-westHandDeliveryCutoff",deliveryState:".js-deliveryState"},this.dom={$component:e,$selectedRate:document.querySelector(this.refs.selectedRate),$holidays:this.$get(this.refs.holidays),$calendarShippingRate:this.$get(this.refs.calendarShippingRate),$weekdayCutoff:this.$get(this.refs.weekdayCutoff),$saturdayCutoff:this.$get(this.refs.saturdayCutoff),$eastHandDeliveryCutoff:this.$get(this.refs.eastHandDeliveryCutoff),$westHandDeliveryCutoff:this.$get(this.refs.westHandDeliveryCutoff),$deliveryState:this.$get(this.refs.deliveryState)},this.state={holidays:[],calendarShippingRate:"",weekdayCutoff:0,saturdayCutoff:0,eastHandDeliveryCutoff:0,westHandDeliveryCutoff:0},this.mount(),this.init()}mount(){super.mount(),this.setClick(document,this.onDocumentClick,{preventDefault:!1})}init(){const{state:e,dom:t}=this;let n=t.$holidays.innerHTML;e.calendarShippingRate=t.$calendarShippingRate.innerHTML.replace(/[\r\n+]/gm,""),e.weekdayCutoff=parseInt(t.$weekdayCutoff.innerHTML,10),e.saturdayCutoff=parseInt(t.$saturdayCutoff.innerHTML,10),e.eastHandDeliveryCutoff=parseInt(t.$eastHandDeliveryCutoff.innerHTML,10),e.westHandDeliveryCutoff=parseInt(t.$westHandDeliveryCutoff.innerHTML,10),n=n.replace(/[\r\n\s+]/gm,""),e.holidays=n.split(","),e.holidays.sort((e,t)=>new Date(e)-new Date(t))}onDocumentClick(e){e.target.closest("form[data-shipping-method-form] #continue_button")&&this.onShippingSubmit()}getSelectedRate(){const{refs:e}=this,t=document.querySelector(e.selectedRate).getAttribute("id");let n=document.querySelector("label[for='".concat(t,"']")).querySelector(".radio__label__primary").innerHTML;return[n]=n.split("<br>"),n.trim()}getAttributes(e){const{dom:t,state:n}=this,i={deliveryState:t.$deliveryState.innerHTML.trim(),isHandDelivery:e.includes("Concierge"),calendarOrder:e===n.calendarShippingRate,leadTime:0};if(i.deliveryDate=deliveryDatePicker&&i.calendarOrder?deliveryDatePicker.$data.selectedDate:null,i.calendarOrder=i.calendarOrder&&null!=i.deliveryDate,i.transitTime=this.getTransitTime(e,i.isHandDelivery,i.deliveryState),i.deliveryDate){const e=new Date(i.deliveryDate);i.leadTime=Math.ceil((e-new Date)/864e5),i.upcharge=i.leadTime<=i.transitTime+1}return i}getTransitTime(e,t,n){let i;return i=t||"Overnight Shipping"===e?1:this.getEstimateTransitTime(n),i}getEstimateTransitTime(e){return["DE","PA","NJ","CA","NV","NY","MA","VT","MD","RI","CT"].includes(e)?1:["IL","IN","OH","KY","WV","VA","NC","SC","GA","TN","MO","MI","AZ","NM","ID","UT","NH","ME","DC"].includes(e)?2:["KS","WA","OR","MT","LA","FL","AL","MS","TX","IA","WI","MN","AR","NE","OK","CO","WY","AK","HI"].includes(e)?3:["ND","SD"].includes(e)?4:["PR"].includes(e)?5:6}calculateShipDate(e,t){const{state:n}=this,{deliveryState:i,isHandDelivery:s,deliveryDate:a,leadTime:o,transitTime:r}=t,l=this;let d=new Date((new Date).toLocaleString("en-US",{timeZone:"America/New_York"}));if(s){const e="CA"===i?n.westHandDeliveryCutoff:n.eastHandDeliveryCutoff;d="CA"===i?new Date((new Date).toLocaleString("en-US",{timeZone:"America/Los_Angeles"})):new Date((new Date).toLocaleString("en-US",{timeZone:"America/New_York"})),d.getHours()>=e&&d.setDate(d.getDate()+1)}else e===n.calendarShippingRate&&a&&o>r+1&&(d=new Date(a),d.setDate(d.getDate()-(r+1)),this.isSunday(d)&&d.setDate(d.getDate()-1)),this.isSaturday(d)?d.getHours()>=n.saturdayCutoff&&d.setDate(d.getDate()+2):d.getHours()>=n.weekdayCutoff&&d.setDate(d.getDate()+1);return this.isSunday(d)&&!s&&d.setDate(d.getDate()+1),n.holidays.forEach(e=>{const t=new Date(e);l.formatDate(d)===l.formatDate(t)&&d.setDate(d.getDate()+1),l.isSunday(d)&&!s&&d.setDate(d.getDate()+1)}),d}calculateDelivery(e,t){const n=new Date(t);return"Standard Shipping"===e?n.setDate(n.getDate()+7):e.includes("Overnight Shipping")||e.includes("Sunday")?this.isSaturday(n)||this.isSunday(n)?n.setDate(n.getDate()+2):n.setDate(n.getDate()+1):e.includes("Express Shipping")?n.setDate(n.getDate()+3):e.includes("Concierge")||n.setDate(n.getDate()+7),n}isSaturday(e){return 6===e.getDay()}isSunday(e){return 0===e.getDay()}formatDate(e){const t=e.getFullYear(),n="0".concat(e.getMonth()+1).slice(-2),i="0".concat(e.getDate()).slice(-2);return"".concat(t,"-").concat(n,"-").concat(i)}setCheckoutAttribute(e,t){const n=document.createElement("input"),i=document.querySelector("form[data-shipping-method-form]");n.setAttribute("type","hidden"),n.setAttribute("name","checkout[attributes][".concat(e,"]")),i.append(n),n.setAttribute("value",t)}onShippingSubmit(){const e=this.getSelectedRate(),t=this.getAttributes(e),n=this.calculateShipDate(e,t),{isHandDelivery:i,calendarOrder:s,deliveryDate:a,leadTime:o,upcharge:r}=t;let l=a;l||(l=this.calculateDelivery(e,n)),this.setCheckoutAttribute("is_hand_delivery",i),this.setCheckoutAttribute("calendar_order",s),this.setCheckoutAttribute("delivery_date",this.formatDate(l)),s&&(this.setCheckoutAttribute("lead_time",o),this.setCheckoutAttribute("escalate",r))}},CheckoutDisclaimer:()=>{}})})();